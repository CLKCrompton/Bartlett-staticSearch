<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." name="buildTestSite" default="all">
  <description>This build builds the test site for development.</description>
    
    <property name="branch" value="master"/>
    
    <target name="buildStaticSearch">
        <ant antfile="build.xml" usenativebasedir="true" inheritall="false">
            <property name="headless" value="true"/>
        </ant>
    </target>
    
    <target name="getOldSite">
        <mkdir dir="oldSite"/>
        <exec executable="git">
            <arg line="clone https://github.com/projectEndings/staticSearchSite oldSite"/>
        </exec>
    </target>
    
    
    <target name="move">
        <echo>Creating deploy/${branch} for deployment and
        copying products...</echo>
        <mkdir dir="deploy/${branch}"/>
        <copy todir="deploy">
            <fileset dir="oldSite">
                <include name="**"/>
            </fileset>
        </copy>
        <copy todir="deploy/${branch}" overwrite="true">
            <fileset dir="test">
                <include name="**"/>
            </fileset>
        </copy>
    </target>
    
    <target name="createIndexPage">
        <java classpath="lib/saxon9he.jar" classname="net.sf.saxon.Transform" failonerror="true" >
            <arg value="-xsl:${basedir}/site/makeIndexPage.xsl"/>
            <arg value="-o:deploy/index.html"/>
            <arg value="-it:go"/>
            <arg value="--suppressXsltNamespaceCheck:on"/>
        </java>
    </target>
    
    
    
    <target name="all" depends="buildStaticSearch, getOldSite, move, createIndexPage">
        <echo>Doing nothing yet and working on this branch: ${branch}.</echo>
    </target>
    
</project>